# 追加機能（出来高＆予算）パッチ

## 1) 出来高（1秒ごとに0〜1000）
- `service/VolumeService.java` を追加
  - マーケット×銘柄ごとに、1秒ごとに 0〜1000 のランダムな出来高を生成
  - 取引実行時に出来高を消費（両市場）
  - `GET /api/volumes` で現在の出来高スナップショットを確認可能

## 2) 予算（同時使用上限）
- `service/BudgetService.java` を追加
  - 「取引開始前に入力した金額」を 1 ティック（1秒）内で同時に使ってよい上限として管理
  - `POST /api/control/budget?amount=500000` で設定
  - ティック開始時に残額を予算額に自動リセット

## 3) シミュレーション実行ロジックの更新
- `service/SimulationEngine.java` を全面差し替え
  - 価格更新
  - ベストな買い市場／売り市場の探索
  - **出来高制約** と **予算制約** を考慮して数量を決定（整数）
  - 手数料（`FeeService`）とネット利益しきい値（`SimulationConfig.threshold`）を満たす場合のみ `Trade` を保存

## 4) UI
- `/ui/control` ページ（`templates/control.html`）を追加
  - 予算入力 → 設定
  - 取引 ON/OFF 切り替え
  - 「取引開始」ボタン（予算設定→取引ON→`/ui/analytics` へ遷移）
- `PageController` に `/ui/control` を追加

---

### 使い方（手順）
1. アプリを起動
2. ブラウザで `http://localhost:8080/ui/control` を開く
3. 「予算（円）」に金額を入力して **予算を設定** または **取引開始**
4. **取引ON**／**OFF** は手動でも可
5. 必要に応じて `GET /api/volumes` で出来高を確認

> 注: 予算は「同時に使ってよい上限」として 1 秒ごとにリセットされます。
> 本格的な資金繰り（約定のキャッシュフローを継続反映）にしたい場合は、
> セッション残高を時系列で更新する口座管理を別途追加する設計に拡張可能です。
